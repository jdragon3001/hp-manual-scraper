# Problem Log

## Purpose
This file tracks persistent issues and challenges encountered during development.

Created: November 12, 2025

---

## Issues

### RESOLVED: manua.ls PDF Download Challenge
**Date**: November 12, 2025  
**Problem**: manua.ls doesn't provide direct PDF downloads. Site uses pdf2htmlEX to convert PDFs to HTML.

**Attempted Solutions**:
1. ❌ Direct PDF URL extraction - No PDF files available
2. ❌ Playwright browser automation - Generated corrupted PDFs (HTML saved as PDF)

**Final Solution**: ✅ Text extraction from ALL pages
- Extracts content from each page (e.g., ?p=1, ?p=2, ... ?p=126)
- Preserves formatting and structure
- Much faster than browser automation
- Produces clean, searchable text files
- Successfully tested with 126-page manual → 1,839 lines, 98KB

---

### OPEN: Two Different Rendering Methods on manua.ls
**Date**: December 3, 2025  
**Problem**: manua.ls uses TWO different rendering methods for manuals:

#### Method 1: HTML Text Rendering (Works with existing scraper)
- Text is placed in div elements with CSS positioning
- Class names like `t m0` contain actual readable text
- Example: HP 14 manual, Dell manuals, most downloaded manuals
- **Status**: ✅ Working with `text_extractor.py`

#### Method 2: Image + Font Obfuscation (NEEDS OCR)
- Page rendered as webp background image (`/viewer/90/{file_id}/{page}/bg{page}.webp`)
- Text overlay uses Private Use Area Unicode characters (`\uea34`, `\uea65`, etc.)
- Custom font maps these to glyphs, but glyph names are opaque
- Example: ASUS Vivobook 16 manual
- **Status**: ⚠️ Requires OCR to extract

**Investigation Files**:
- `detect_manual_type.py` - Detects which rendering method a manual uses
- `investigate_page_html.py` - Deep HTML analysis
- `font_decoder.py` - Attempted font-based decoding (limited success)
- `ocr_extractor.py` - OCR-based extraction (requires Tesseract)

**Solutions for Image-Based Manuals**:
1. **Install Tesseract OCR** - Best solution
   - Download: https://github.com/UB-Mannheim/tesseract/wiki
   - Run: `python ocr_extractor.py`
2. **Skip image-based manuals** - Only scrape HTML text manuals
3. **Cloud OCR API** - Use Google Vision, AWS Textract (requires setup/costs)

**Key Finding**: Most HP, Dell, Lenovo, Acer manuals use HTML text rendering and work fine.
Some ASUS and other manuals use image rendering. Can detect which type before scraping.

---

### RESOLVED: Robust Extractor with Fallbacks
**Date**: December 3, 2025  
**Problem**: Some manuals extract poorly (little/no text) while others work fine.

**Solution**: Created `src/robust_extractor.py` with fallback strategy:
1. **Primary**: Text extraction via Playwright `.innerText`
2. **Fallback**: Download page images if text < 50 chars avg per page
3. **OCR**: If Tesseract installed, run OCR on images
4. **Backup**: Save images to `{model}_images/` folder for later processing

**Usage**: Scraper now uses `save_manual_robust()` by default.

**Result**: Always get SOMETHING from every manual - either text or images.

---

### ACTIVE: Timeout and Empty Extraction Issues
**Date**: December 9, 2025  
**Problem**: Some manuals (e.g., ECS T30Ii - 103 pages) timeout at page 20 and return empty content.

**Symptoms**:
- Page loading times out after 6 seconds (original timeout)
- After 3 consecutive timeouts, extraction fails
- Manual marked as EMPTY and queued for retry
- Retry attempts also fail with same issue

**Possible Root Causes**:
1. **Rate Limiting**: Website detecting automated browsing and slowing responses
2. **Short Timeouts**: 6s timeout may be too aggressive for slower pages
3. **Network Congestion**: Website or connection issues
4. **Rendering Type**: Manual may use image-based rendering (see issue above)

**Solutions Implemented**:
1. ✅ Increased page load timeout from 6s to 15s
2. ✅ Increased consecutive failure threshold from 3 to 5
3. ✅ Added 2-second delay before retrying failed pages
4. ✅ Increased delay between pages from 0.3-0.5s to 0.5-1.0s
5. ✅ Increased delay between manuals from 2-5s to 3-7s
6. ✅ Added fallback text extraction (try body.innerText if .viewer-page fails)
7. ✅ Added diagnostic script (`diagnose_manual.py`) to test specific URLs
8. ✅ Added empty page logging for better debugging

**Testing**:
```bash
# Test specific manual that's failing
python diagnose_manual.py https://www.manua.ls/ecs/t30ii/manual

# Resume scraping with fixes
conda activate manual-scraper
python scrape_brand.py ECS
```

**Status**: ✅ RESOLVED - Added redirect detection

**Resolution**: 
The actual problem was that some manuals in the cache **no longer exist on the website**. When accessing them, the site redirects to the brand page instead of showing the manual. The scraper was waiting for manual content that would never appear.

**Fix**: Added redirect detection:
- Check if page.url changed after navigation
- If redirected → Skip manual (mark as done, don't retry)
- If not redirected → Extract normally

**Testing confirmed**:
- G320 manual: Exists, extracts successfully ✓
- T30Ii manual: Redirects to brand page, now skipped automatically ✓

